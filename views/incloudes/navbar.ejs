

<!-- Modern Navbar -->
<nav class="modern-navbar navbar navbar-expand-lg fixed-top" id="mainNavbar">
  <div class="navbar-container">
    <!-- Logo Section -->
    <a class="navbar-brand" href="/listings">
      <div class="brand-icon">
        <i class="fa-brands fa-sitrox"></i>
      </div>
      <span class="brand-text">SnapTrip</span>
    </a>

    <!-- Search Bar - Centered -->
    <div class="search-container">
      <form action="/listings" method="GET" class="modern-search-form">
        <div class="search-field search-field-large">
          <input type="text" name="q" class="search-input" 
                 placeholder="Search listings by title, city, or country..." 
                 value="<%= typeof q !== 'undefined' ? q : '' %>" />
        </div>
        <button type="submit" class="search-submit-btn" aria-label="Search">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
      </form>
    </div>

    <!-- Right Section -->
    <div class="navbar-actions">
      <a href="/listings/new" class="host-link">SnapTrip your home</a>
      
      <!-- Theme Toggle -->
      <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
        <i class="fa-solid fa-moon"></i>
      </button>

      <!-- Auth Buttons -->
      <div class="auth-buttons">
        <% if(!currUser) {%>
          <a href="/login" class="auth-btn login-btn">Log in</a>
          <a href="/signup" class="auth-btn signup-btn">Sign up</a>
        <% } else { %>
          <a href="/logout" class="auth-btn logout-btn">Log out</a>
        <% } %>
      </div>

      <!-- User Menu -->
      <div class="user-menu" id="userMenu">
        <button class="user-menu-btn" aria-label="User menu">
          <i class="fa-solid fa-bars"></i>
          <div class="user-avatar">
            <i class="fa-solid fa-user"></i>
          </div>
        </button>
        <div class="user-dropdown" id="userDropdown">
          <% if(!currUser) {%>
            <a href="/signup" class="dropdown-item">Sign up</a>
            <a href="/login" class="dropdown-item">Log in</a>
          <% } else { %>
            <a href="/logout" class="dropdown-item">Log out</a>
          <% } %>
          <div class="dropdown-divider"></div>
          <a href="/categories" class="dropdown-item">Categories</a>
          <a href="/listings/new" class="dropdown-item">SnapTrip your home</a>
          <a href="/help" class="dropdown-item">Help Center</a>
        </div>
      </div>
    </div>

    <!-- Mobile Toggle -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fa-solid fa-bars"></i>
    </button>
  </div>

  <!-- Mobile Search -->
  <div class="mobile-search-bar">
    <form action="/listings" method="GET" class="mobile-search-input">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input type="text" name="q" placeholder="Search listings..." value="<%= typeof q !== 'undefined' ? q : '' %>" />
    </form>
  </div>
</nav>

<!-- Mobile Menu -->
<div class="collapse navbar-collapse mobile-nav" id="navbarNavAltMarkup">
  <div class="mobile-nav-content">
    <a class="mobile-nav-link" href="/listings">
      <i class="fa-solid fa-compass"></i> Explore
    </a>
    <% if(!currUser) {%>
      <a class="mobile-nav-link" href="/signup">
        <i class="fa-solid fa-user-plus"></i> Sign up
      </a>
      <a class="mobile-nav-link" href="/login">
        <i class="fa-solid fa-sign-in-alt"></i> Log in
      </a>
    <% } else { %>
      <a class="mobile-nav-link" href="/logout">
        <i class="fa-solid fa-sign-out-alt"></i> Log out
      </a>
    <% } %>
    <a class="mobile-nav-link" href="/categories">
      <i class="fa-solid fa-folder"></i> Categories
    </a>
    <div class="mobile-nav-divider"></div>
    <a class="mobile-nav-link" href="/listings/new">
      <i class="fa-solid fa-home"></i> SnapTrip your home
    </a>
    <a class="mobile-nav-link" href="/help">
      <i class="fa-solid fa-circle-question"></i> Help Center
    </a>
  </div>
</div>

<script>
  // Modern Navbar Controller
  class ModernNavbar {
    constructor() {
      this.navbar = document.getElementById('mainNavbar');
      this.userMenu = document.getElementById('userMenu');
      this.userDropdown = document.getElementById('userDropdown');
      this.themeToggle = document.getElementById('theme-toggle');
      this.lastScrollY = window.scrollY;
      this.init();
    }

    init() {
      this.bindEvents();
      this.handleScroll();
      this.initTheme();
    }

    bindEvents() {
      // Scroll effects
      window.addEventListener('scroll', () => this.handleScroll());

      // User menu toggle
      if (this.userMenu) {
        this.userMenu.addEventListener('click', (e) => {
          e.stopPropagation();
          this.toggleUserDropdown();
        });
      }

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (this.userMenu && !this.userMenu.contains(e.target)) {
          this.userDropdown.classList.remove('show');
        }
      });

      // Theme toggle
      if (this.themeToggle) {
        this.themeToggle.addEventListener('click', () => this.toggleTheme());
      }
    }

    handleScroll() {
      const currentScrollY = window.scrollY;

      if (currentScrollY > 50) {
        this.navbar.classList.add('scrolled');
      } else {
        this.navbar.classList.remove('scrolled');
      }

      this.lastScrollY = currentScrollY;
    }

    toggleUserDropdown() {
      this.userDropdown.classList.toggle('show');
    }

    initTheme() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      this.updateThemeIcon(savedTheme);
    }

    toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      this.updateThemeIcon(newTheme);
    }

    updateThemeIcon(theme) {
      if (this.themeToggle) {
        const icon = this.themeToggle.querySelector('i');
        icon.className = theme === 'dark' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
      }
    }
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    new ModernNavbar();
  });
</script>

